<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <title>libvips</title>
    <meta name="description" content="A fast image processing library with low memory needs.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Cabin:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/libvips/assets/css/style.css">
    <link rel="shortcut icon" type="image/x-icon" href="/libvips/favicon.ico">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name"><a href="/libvips">libvips</a></h1>
      <h2 class="project-tagline">A fast image processing library with low memory needs.</h2>
      <a href="https://github.com/libvips/libvips" class="btn">Project on GitHub</a>
      <a href="https://github.com/libvips/libvips/releases" class="btn">Download</a>
      <a href="/libvips/install.html" class="btn">Install</a>
      <a href="/libvips/API/current" class="btn">Documentation</a>
      <a href="https://github.com/libvips/libvips/issues" class="btn">Issues</a>
      <a href="https://github.com/libvips/libvips/wiki" class="btn">Wiki</a>
    </section>

    <section class="main-content">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="5"><tr valign="middle">
<td width="100%" align="left" class="shortcuts"></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="16" height="16" border="0" alt="Home"></a></td>
<td><a accesskey="u" href="How-it-works.md.html"><img src="up.png" width="16" height="16" border="0" alt="Up"></a></td>
<td><a accesskey="p" href="data-sources.html"><img src="left.png" width="16" height="16" border="0" alt="Prev"></a></td>
<td><a accesskey="n" href="operation-cache.html"><img src="right.png" width="16" height="16" border="0" alt="Next"></a></td>
</tr></table>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="data-sinks"></a>Data sinks</h2></div></div></div>
<p>
    In a demand-driven system, something has to do the demanding. VIPS has a variety of data sinks that you can use to pull image data though a pipeline in various situations. There are sinks that will build a complete image in memory, sinks to draw to a display, sinks to loop over an image (useful for statistical operations, for example) and sinks to stream an image to disc.
  </p>
<p>
    The disc sink looks something like this:
  </p>
<p>
    <span class="inlinemediaobject"><img src="Sink.png"></span>
  </p>
<p>
    The sink keeps two buffers*, each as wide as the image. It starts threads as rapidly as it can up to the concurrency limit, filling each buffer with tiles** of calculated pixels, each thread calculating one tile at once. A separate background thread watches each buffer and, as soon as the last tile in a buffer finishes, writes that complete set of scanlines to disc using whatever image write library is appropriate. VIPS can write with libjpeg, libtiff, libpng and others. It then wipes the buffer and repositions it further down the image, ready for the next set of tiles to stream in.
  </p>
<p>
    These features in combination mean that, once a pipeline of image processing operations has been built, VIPS can run almost lock-free. This is very important for SMP scaling: you donâ€™t want the synchronization overhead to scale with either the number of threads or the complexity of the pipeline of operations being performed. As a result, VIPS scales almost linearly with increasing numbers of threads:
  </p>
<p>
    <span class="inlinemediaobject"><img src="Vips-smp.png"></span>
  </p>
<p>
    Number of CPUs is on the horizontal axis, speedup is on the vertical axis. Taken from the [[Benchmarks]] page.
  </p>
<p>
    (* there can actually be more than one, it allocate enough buffers to ensure that there are at least two tiles for every thread)
  </p>
<p>
    (** tiles can be any shape and size, VIPS has a tile hint system that operations use to tell sinks what tile geometry they prefer)
  </p>
</div>
<div class="footer">
<hr>Generated by GTK-Doc V1.28</div>
</section>

    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-48550036-2', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
